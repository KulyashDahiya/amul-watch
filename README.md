# 🥛 AMUL-WATCH

A lightweight watcher that keeps an eye on selected **Amul Shop** products and notifies you the moment they’re back in stock.
Runs automatically via **GitHub Actions** every 5 minutes (or on demand). Alerts can be sent to **Telegram** 💬 and/or **Email** 📧.

---

## 🚀 How it works

* Bootstraps a browsing session, sets **substore preference** (region), and queries Amul’s product API.
* Tracks product availability in `state.json`.
* Sends notifications **only when availability changes** (`Out of stock → Available`).
* Caches both:

  * **Python venv** (for faster installs).
  * **State file** (so it remembers last run).

---

## 📂 Project structure

```
.github/workflows/amul_watch.yml   # GitHub Actions workflow
amul_watch.py                      # Core watcher script
requirements.txt                   # Python dependencies
.env                               # Local testing env vars
state.json                         # Persisted state (autogenerated)
README.md                          # This file
```

---

## ⚙️ Setup & Usage

### 🔧 Local run

1. **Install dependencies**

   ```bash
   python3.11 -m venv .venv
   source .venv/bin/activate
   pip install --upgrade pip -r requirements.txt
   ```

2. **Configure `.env`**

   ```ini
   TELEGRAM_BOT_TOKEN=123456:abc...
   TELEGRAM_CHAT_ID=123456789

   EMAIL_FROM=alerts@example.com
   EMAIL_TO=you@example.com
   SMTP_HOST=smtp.example.com
   SMTP_PORT=587
   SMTP_USER=alerts@example.com
   SMTP_PASS=yourpassword

   FORCE_ALERT=0
   ```

3. **Choose products to track**
   Edit `TARGET_ALIASES` inside `amul_watch.py`:

   ```python
   TARGET_ALIASES = [
       "amul-high-protein-rose-lassi-200-ml-or-pack-of-30",
   ]
   ```

4. **Run it**

   ```bash
   python amul_watch.py
   ```

---

### ☁️ GitHub Actions

The workflow `.github/workflows/amul_watch.yml`:

* Runs **every 5 minutes** (`*/5 * * * *`).
* Can also be triggered manually.
* Cancels overlapping runs.
* Caches `.venv/` + `state.json`.

#### 🔑 Add repository secrets

* `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID`
* `EMAIL_FROM`, `EMAIL_TO`, `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`

*(set only what you use — missing configs are skipped automatically)*

#### 🔧 Optional variable

* `FORCE_ALERT=1` → send a test alert on next run.

---

## 🛎️ Alerts

* ✅ **Triggers**: when product availability flips `False → True`.
* ❌ **No spam**: stays silent if still available/unavailable.
* 🧪 **Testing**: set `FORCE_ALERT=1` to force an alert once.

---

## 🔍 Troubleshooting

* **No alerts?** → Check product aliases, substore settings, and secrets.
* **Seeing only notices?** → That’s normal, means availability didn’t change.
* **Different region?** → Update `set_preference_substore("up-ncr")` and `SUBSTORE_ID` in `amul_watch.py`.

---

## 📜 License

MIT — free to use, improve, and share.
If you add more regions, alerts, or cool features, PRs are always welcome!
