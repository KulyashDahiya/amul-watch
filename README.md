# 🥛 AMUL-WATCH

An automation tool that monitors **Amul Shop** products and alerts you when they’re back in stock.
Runs every 5 minutes via **GitHub Actions**, or locally with Python. Alerts can be sent via **Telegram** 💬 and/or **Email** 📧.

---

## 🚀 Features

* Tracks product availability using Amul’s API.
* Region-aware: uses your **PINCODE** to set the right substore.
* Persists state (`state.json`) to only notify on availability transitions.
* Notifications via **Telegram** or **Email**.
* Efficient: caches Python venv and state in Actions.
* Includes **India-wide pincode datasets** for advanced region mapping.

---

## 📂 Repository structure

```
.github/workflows/amul_watch.yml   # GitHub Actions workflow
amul_watch.py                      # Core watcher script
data/pincode_rules.json            # Rules to map PIN → substore alias
data/substores.json                # Substore IDs per region
tools/build_pincode_index.py       # Build index from GeoJSON
tools/extract_by_pincode.py        # Extract single pincode geometry
Pincodes/app_india_pincodes.geojson # Full India pincodes map (Git LFS)
requirements.txt                   # Python dependencies
state.json                         # Persisted state (autogenerated)
README.md                          # This file
```

---

## ⚙️ Setup & Usage

### 🔧 Local run

1. **Install dependencies**

   ```bash
   python3.11 -m venv .venv
   source .venv/bin/activate
   pip install --upgrade pip -r requirements.txt
   ```

2. **Create `.env`**

   ```ini
   PINCODE=110001
   FORCE_ALERT=0

   TELEGRAM_BOT_TOKEN=123456:abc...
   TELEGRAM_CHAT_ID=123456789

   EMAIL_FROM=alerts@example.com
   EMAIL_TO=you@example.com
   SMTP_HOST=smtp.example.com
   SMTP_PORT=587
   SMTP_USER=alerts@example.com
   SMTP_PASS=yourpassword
   ```

3. **Edit products to track** in `amul_watch.py`:

   ```python
   TARGET_ALIASES = [
       "amul-high-protein-rose-lassi-200-ml-or-pack-of-30",
   ]
   ```

4. **Run**

   ```bash
   python amul_watch.py
   ```

---

### ☁️ GitHub Actions

Workflow: `.github/workflows/amul_watch.yml`

* Runs **every 5 minutes** (`*/5 * * * *`).
* Cancels overlapping runs.
* Restores/saves state.json so alerts are change-only.
* Uses venv caching for faster runs.

#### 🔑 Required Variables/Secrets

* **Variables**

  * `PINCODE` → 6-digit postal code.
  * `FORCE_ALERT` → optional, `1` to force alerts (defaults to 0).

* **Secrets**

  * `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID`
  * `EMAIL_FROM`, `EMAIL_TO`, `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`

> Configure in **Repo Settings → Secrets and variables → Actions**.

---

## 🛎️ Alerts

* ✅ Fires when product availability flips `False → True`.
* ❌ Silent if still available/unavailable.
* 🧪 Use `FORCE_ALERT=1` to send a one-time test alert.

---

## 🌍 Pincode datasets

This repo includes datasets for richer region mapping:

* **`data/pincode_rules.json`** → lightweight rules for mapping PIN → substore alias (used by default).
* **`data/substores.json`** → Amul substore IDs per region.
* **`Pincodes/app_india_pincodes.geojson`**

  * Detailed map of all India pincodes (~86 MB).
  * Tracked with **Git LFS**.
  * Not required for normal watcher runs.
  * Useful if you want to:

    * Build dashboards (map overlays).
    * Extend PIN → substore mapping.
    * Contribute better rules.

### Tools

* **`tools/build_pincode_index.py`** → Build a fast lookup index from the GeoJSON.
* **`tools/extract_by_pincode.py`** → Extract specific PIN geometry + metadata.

---

## 🔍 Troubleshooting

* **Missing alerts?** → Check PINCODE, product aliases, and secrets.
* **Frequent notices?** → Normal if availability hasn’t changed.
* **Different region?** → Update `pincode_rules.json` or use GeoJSON-based tools.

---

## 📜 License

MIT — free to use, improve, and share.
PRs welcome if you add new regions, smarter mapping, or alerting improvements!
